{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/smykla-skalski/.github/main/schemas/settings.schema.json",
  "title": "Repository Settings",
  "description": "Repository settings definition for organization-wide synchronization. Place at .github/settings.yml in your repository.",
  "$ref": "#/$defs/SettingsFile",
  "$defs": {
    "BranchProtectionRuleConfig": {
      "description": "Configures protection rules for branches including required status checks, required reviews, and restrictions on who can push",
      "type": "object",
      "required": [ "pattern" ],
      "properties": {
        "allow_deletions": {
          "description": "Allow branch deletion",
          "type": "boolean"
        },
        "allow_force_pushes": {
          "description": "Allow force pushes to this branch",
          "type": "boolean"
        },
        "enforce_admins": {
          "description": "Enforce branch protection rules for administrators",
          "type": "boolean"
        },
        "pattern": {
          "description": "Branch name pattern",
          "type": "string",
          "minLength": 1
        },
        "require_linear_history": {
          "description": "Require linear commit history",
          "type": "boolean"
        },
        "required_conversation_resolution": {
          "description": "Require all conversations on code to be resolved before pull request can be merged",
          "type": "boolean"
        },
        "required_reviews": {
          "description": "Required pull request reviews configuration",
          "$ref": "#/$defs/RequiredReviews"
        },
        "required_status_checks": {
          "description": "Required status checks configuration",
          "$ref": "#/$defs/RequiredStatusChecks"
        },
        "restrictions": {
          "description": "Restrict who can push to this branch. Leave unset to allow all users with push access",
          "$ref": "#/$defs/BranchRestrictionsConfig"
        }
      },
      "additionalProperties": false
    },
    "BranchRestrictionsConfig": {
      "description": "BranchRestrictionsConfig defines who can push to protected branches.",
      "type": "object",
      "properties": {
        "apps": {
          "description": "GitHub App slugs allowed to push",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "teams": {
          "description": "GitHub team slugs allowed to push",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "users": {
          "description": "GitHub usernames allowed to push",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "BypassActorConfig": {
      "description": "Defines an actor (user, team, app, or role) who can bypass ruleset requirements",
      "type": "object",
      "required": [ "actor_id", "actor_type", "bypass_mode" ],
      "properties": {
        "actor_id": {
          "description": "Actor ID (user ID, team ID, app ID, or role ID)",
          "type": "integer"
        },
        "actor_type": {
          "description": "Actor type (Integration, OrganizationAdmin, RepositoryRole, or Team)",
          "enum": [
            "Integration",
            "OrganizationAdmin",
            "RepositoryRole",
            "Team"
          ]
        },
        "bypass_mode": {
          "description": "Bypass mode (always or pull_request)",
          "enum": [ "always", "pull_request" ]
        }
      },
      "additionalProperties": false
    },
    "BypassPullRequestAllowances": {
      "description": "BypassPullRequestAllowances defines who can bypass pull request requirements.",
      "type": "object",
      "properties": {
        "apps": {
          "description": "GitHub App slugs that can bypass pull request requirements",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "teams": {
          "description": "GitHub team slugs that can bypass pull request requirements",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "users": {
          "description": "GitHub usernames that can bypass pull request requirements",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": false
    },
    "CodeScanningRuleConfig": {
      "description": "Configures code scanning tool requirements and alert thresholds",
      "type": "object",
      "properties": {
        "code_scanning_tools": {
          "description": "Code scanning tools and their thresholds",
          "type": "array",
          "items": {
            "$ref": "#/$defs/CodeScanningToolConfig"
          }
        }
      },
      "additionalProperties": false
    },
    "CodeScanningToolConfig": {
      "description": "Defines a code scanning tool with alert thresholds",
      "type": "object",
      "required": [ "tool", "alerts_threshold", "security_alerts_threshold" ],
      "properties": {
        "alerts_threshold": {
          "description": "Alert threshold level (none, errors, errors_and_warnings, all)",
          "enum": [ "none", "errors", "errors_and_warnings", "all" ]
        },
        "security_alerts_threshold": {
          "description": "Security alert threshold level (none, critical, high_or_higher, medium_or_higher, all)",
          "enum": [
            "none",
            "critical",
            "high_or_higher",
            "medium_or_higher",
            "all"
          ]
        },
        "tool": {
          "description": "Tool name (e.g., \"CodeQL\")",
          "type": "string",
          "minLength": 1
        }
      },
      "additionalProperties": false
    },
    "FeaturesConfig": {
      "description": "Controls which GitHub features are enabled for the repository (Issues, Wiki, Projects, Discussions)",
      "type": "object",
      "properties": {
        "has_discussions": {
          "description": "Enable GitHub Discussions",
          "type": "boolean"
        },
        "has_issues": {
          "description": "Enable GitHub Issues",
          "type": "boolean"
        },
        "has_projects": {
          "description": "Enable GitHub Projects",
          "type": "boolean"
        },
        "has_wiki": {
          "description": "Enable GitHub Wiki",
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "PullRequestRuleConfig": {
      "description": "Configures pull request requirements including reviews, code owners, and merge strategies",
      "type": "object",
      "properties": {
        "allowed_merge_methods": {
          "description": "Allowed merge methods (squash, merge, rebase)",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "enum": [ "squash", "merge", "rebase" ]
          }
        },
        "dismiss_stale_reviews_on_push": {
          "description": "Dismiss stale reviews when new commits are pushed",
          "type": "boolean"
        },
        "require_code_owner_review": {
          "description": "Require review from code owners",
          "type": "boolean"
        },
        "require_last_push_approval": {
          "description": "Require approval of the most recent reviewable push",
          "type": "boolean"
        },
        "required_approving_review_count": {
          "description": "Number of required approving reviews (0-6)",
          "type": "integer",
          "maximum": 6,
          "minimum": 0
        },
        "required_review_thread_resolution": {
          "description": "Require all conversations to be resolved before merging",
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "RefNameCondition": {
      "description": "Specifies include/exclude patterns for ref names (branches or tags)",
      "type": "object",
      "properties": {
        "exclude": {
          "description": "Ref patterns to exclude",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "pattern": "^refs/",
            "minLength": 1
          }
        },
        "include": {
          "description": "Ref patterns to include (e.g., \"refs/heads/main\", \"refs/heads/release/*\")",
          "type": "array",
          "uniqueItems": true,
          "items": {
            "type": "string",
            "pattern": "^refs/",
            "minLength": 1
          }
        }
      },
      "additionalProperties": false
    },
    "RepositorySettingsConfig": {
      "description": "Configures merge strategies and branch cleanup behavior for pull requests",
      "type": "object",
      "properties": {
        "allow_auto_merge": {
          "description": "Allow auto-merge for pull requests",
          "type": "boolean"
        },
        "allow_merge_commit": {
          "description": "Allow merge commits for pull requests",
          "type": "boolean"
        },
        "allow_rebase_merge": {
          "description": "Allow rebase merge for pull requests",
          "type": "boolean"
        },
        "allow_squash_merge": {
          "description": "Allow squash merge for pull requests",
          "type": "boolean"
        },
        "allow_update_branch": {
          "description": "Allow users to update the head branch of a pull request with the latest changes from the base branch",
          "type": "boolean"
        },
        "delete_branch_on_merge": {
          "description": "Automatically delete head branch after pull request is merged",
          "type": "boolean"
        },
        "squash_merge_commit_message": {
          "description": "Message format for squash merge commits (PR_BODY, COMMIT_MESSAGES, or BLANK)",
          "enum": [ "PR_BODY", "COMMIT_MESSAGES", "BLANK" ]
        },
        "squash_merge_commit_title": {
          "description": "Title format for squash merge commits (COMMIT_OR_PR_TITLE or PR_TITLE)",
          "enum": [ "COMMIT_OR_PR_TITLE", "PR_TITLE" ]
        }
      },
      "additionalProperties": false
    },
    "RequiredReviews": {
      "description": "Configures pull request review requirements including approval count, code owner reviews, and who can bypass requirements",
      "type": "object",
      "properties": {
        "bypass_pull_request_allowances": {
          "description": "Allow specified users, teams, or apps to bypass pull request requirements",
          "$ref": "#/$defs/BypassPullRequestAllowances"
        },
        "count": {
          "description": "Number of required approving reviews",
          "type": "integer",
          "maximum": 6,
          "minimum": 0
        },
        "dismiss_stale": {
          "description": "Dismiss stale pull request approvals when new commits are pushed",
          "type": "boolean"
        },
        "require_code_owner_reviews": {
          "description": "Require review from code owners",
          "type": "boolean"
        },
        "require_last_push_approval": {
          "description": "Require approval of the most recent reviewable push",
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "RequiredStatusChecks": {
      "description": "Specifies CI/CD checks that must pass before merging, with option to require branches be up-to-date",
      "type": "object",
      "properties": {
        "contexts": {
          "description": "Required status check contexts. Empty array inherits repo's existing checks (hybrid approach)",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "strict": {
          "description": "Require branches to be up to date before merging",
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "RulesetConditionsConfig": {
      "description": "Defines conditions for when a ruleset applies, primarily using ref name patterns",
      "type": "object",
      "properties": {
        "ref_name": {
          "description": "Ref name patterns (branch/tag names)",
          "$ref": "#/$defs/RefNameCondition"
        }
      },
      "additionalProperties": false
    },
    "RulesetConfig": {
      "description": "Configures GitHub Rulesets (modern replacement for branch protection) with more granular targeting, additional rule types, better bypass management, and enforcement modes",
      "type": "object",
      "required": [ "name", "target", "enforcement" ],
      "properties": {
        "bypass_actors": {
          "description": "Actors who can bypass this ruleset",
          "type": "array",
          "items": {
            "$ref": "#/$defs/BypassActorConfig"
          }
        },
        "conditions": {
          "description": "Conditions for when ruleset applies",
          "$ref": "#/$defs/RulesetConditionsConfig"
        },
        "enforcement": {
          "description": "Enforcement level (active, disabled, or evaluate)",
          "enum": [ "active", "disabled", "evaluate" ]
        },
        "name": {
          "description": "Ruleset name (unique per repository)",
          "type": "string",
          "minLength": 1
        },
        "rules": {
          "description": "Rules to enforce",
          "$ref": "#/$defs/RulesetRulesConfig"
        },
        "target": {
          "description": "Target type (branch, tag, or push)",
          "enum": [ "branch", "tag", "push" ]
        }
      },
      "additionalProperties": false
    },
    "RulesetRulesConfig": {
      "description": "Contains all rule types that can be enforced by a ruleset",
      "type": "object",
      "properties": {
        "code_scanning": {
          "description": "Code scanning requirements",
          "$ref": "#/$defs/CodeScanningRuleConfig"
        },
        "creation": {
          "description": "Prevent branch/tag creation",
          "type": "boolean"
        },
        "deletion": {
          "description": "Prevent branch/tag deletion",
          "type": "boolean"
        },
        "non_fast_forward": {
          "description": "Prevent non-fast-forward pushes",
          "type": "boolean"
        },
        "pull_request": {
          "description": "Pull request rules (reviews, dismissal, code owners)",
          "$ref": "#/$defs/PullRequestRuleConfig"
        },
        "required_linear_history": {
          "description": "Require linear commit history (no merge commits)",
          "type": "boolean"
        },
        "required_signatures": {
          "description": "Require signed commits",
          "type": "boolean"
        },
        "required_status_checks": {
          "description": "Required status checks that must pass",
          "$ref": "#/$defs/StatusChecksRuleConfig"
        },
        "update": {
          "description": "Restrict updates to refs",
          "type": "boolean"
        }
      },
      "additionalProperties": false
    },
    "SecurityConfig": {
      "description": "Configures GitHub Advanced Security features including secret scanning and Dependabot security updates",
      "type": "object",
      "properties": {
        "dependabot_security_updates": {
          "description": "Enable Dependabot security updates",
          "enum": [ "enabled", "disabled" ]
        },
        "secret_scanning": {
          "description": "Enable secret scanning (requires GitHub Advanced Security)",
          "enum": [ "enabled", "disabled" ]
        },
        "secret_scanning_push_protection": {
          "description": "Enable secret scanning push protection (requires GitHub Advanced Security and secret scanning enabled)",
          "enum": [ "enabled", "disabled" ]
        }
      },
      "additionalProperties": false
    },
    "SettingsDefinition": {
      "description": "SettingsDefinition contains all repository settings to sync.",
      "type": "object",
      "properties": {
        "BranchProtection": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/BranchProtectionRuleConfig"
          }
        },
        "Features": {
          "$ref": "#/$defs/FeaturesConfig"
        },
        "Repository": {
          "$ref": "#/$defs/RepositorySettingsConfig"
        },
        "Rulesets": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/RulesetConfig"
          }
        },
        "Security": {
          "$ref": "#/$defs/SecurityConfig"
        }
      },
      "additionalProperties": false
    },
    "SettingsFile": {
      "description": "SettingsFile represents the structure of a settings YAML file.",
      "type": "object",
      "properties": {
        "Settings": {
          "$ref": "#/$defs/SettingsDefinition"
        }
      },
      "additionalProperties": false
    },
    "StatusCheckConfig": {
      "description": "Defines a single required status check with context name and optional integration ID",
      "type": "object",
      "required": [ "context" ],
      "properties": {
        "context": {
          "description": "Status check context name",
          "type": "string",
          "minLength": 1
        },
        "integration_id": {
          "description": "Integration ID for GitHub App status checks (optional)",
          "type": "integer"
        }
      },
      "additionalProperties": false
    },
    "StatusChecksRuleConfig": {
      "description": "Specifies CI/CD status checks that must pass, with option to require strict updates",
      "type": "object",
      "properties": {
        "do_not_enforce_on_create": {
          "description": "When true, do not enforce status check requirements on branches created from protected branches. New branches can temporarily bypass checks when first created",
          "type": "boolean"
        },
        "required_status_checks": {
          "description": "Required status checks. Empty array = skip setting checks (inherit repo's existing)",
          "type": "array",
          "items": {
            "$ref": "#/$defs/StatusCheckConfig"
          }
        },
        "strict_required_status_checks_policy": {
          "description": "Require branches to be up to date before merging (strict mode)",
          "type": "boolean"
        }
      },
      "additionalProperties": false
    }
  }
}

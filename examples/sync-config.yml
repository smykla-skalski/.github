---
# yaml-language-server: $schema=https://raw.githubusercontent.com/smykla-labs/.github/main/schemas/sync-config.schema.json
# Unified Sync Configuration Schema
# ==================================
# Place this file at: .github/sync-config.yml in your repository
#
# This configuration controls how the organization's sync system
# synchronizes labels, files, settings, and smyklot to your repository.
#
# All fields are optional - omit any field to use its default value.
# An empty or missing config file enables all syncs with default behavior.

# ---------------------------------------------------------------------------
# SCHEMA REFERENCE
# ---------------------------------------------------------------------------
#
# sync:                          # Top-level sync configuration
#   skip: bool                   # Skip ALL syncs (default: false)
#
#   labels:                      # Label sync configuration
#     skip: bool                 # Skip label sync (default: false)
#     exclude: [string]          # Label names to exclude from sync
#     allow_removal: bool        # Delete non-central labels (default: false)
#
#   files:                       # File sync configuration
#     skip: bool                 # Skip file sync (default: false)
#     exclude: [string]          # File paths to exclude from sync
#     allow_removal: bool        # Delete non-central files (default: false)
#     merge:                     # File merge configuration
#       - path: string           # File path to merge
#         strategy: string       # Merge strategy: "deep-merge" or "shallow-merge"
#         overrides: object      # Override values to merge with org template
#
#   smyklot:                     # Smyklot synchronization configuration
#     skip: bool                 # Skip ALL smyklot sync (default: false)
#     version:                   # Version-only sync configuration
#       skip: bool               # Skip version updates in workflows (default: false)
#     workflows:                 # Workflow installation configuration
#       pr_commands: bool        # Sync smyklot-pr-commands workflow (default: true)
#       poll: bool               # Sync smyklot-poll workflow (default: true)
#
#   settings:                    # Settings sync configuration
#     skip: bool                 # Skip settings sync (default: false)
#     exclude: [string]          # Settings paths to exclude from sync
#     merge:                     # Settings merge configuration
#       - section: string        # Section to merge (repository, features, security,
#                                # or branch pattern/ruleset name for array items)
#         strategy: string       # Merge strategy: "deep-merge" or "shallow-merge"
#         overrides: object      # Override values to merge with org settings
#
# ---------------------------------------------------------------------------
# FIELD DETAILS
# ---------------------------------------------------------------------------
#
# sync.skip (boolean, default: false)
#   When true, completely skips ALL synchronization for this repository.
#   Use for repositories that should be entirely excluded from org sync.
#   Equivalent to setting both labels.skip and files.skip to true.
#
# sync.labels.skip (boolean, default: false)
#   When true, skips label synchronization only.
#   File sync still runs unless sync.skip or sync.files.skip is true.
#
# sync.labels.exclude (array of strings, default: [])
#   List of label names to exclude from synchronization.
#   These labels will NOT be created/updated in this repository.
#   Existing labels with these names are preserved but not managed.
#   Example: ["ci/skip-tests", "ci/force-full"]
#
# sync.labels.allow_removal (boolean, default: false)
#   When true, labels in this repo that are NOT in the central config
#   will be DELETED. Use with caution - this removes custom labels.
#   When false (default), extra labels in the repo are preserved.
#
# sync.files.skip (boolean, default: false)
#   When true, skips file synchronization only.
#   Label sync still runs unless sync.skip or sync.labels.skip is true.
#
# sync.files.exclude (array of strings, default: [])
#   List of file paths (relative to repo root) to exclude from sync.
#   These files will NOT be created/updated in this repository.
#   Existing files at these paths are preserved but not managed.
#   Example: ["CONTRIBUTING.md", ".github/PULL_REQUEST_TEMPLATE.md"]
#
# sync.files.allow_removal (boolean, default: false)
#   DANGEROUS: When true, files in this repo that are NOT in the central
#   sync config will be DELETED. This can cause data loss.
#   Strongly recommend keeping this false (default).
#
# sync.files.merge (array of objects, default: [])
#   Configure files to MERGE with org templates instead of replacing entirely.
#   This allows repos to customize specific fields while inheriting org defaults.
#   Each merge config specifies: path, strategy, and overrides.
#
# sync.files.merge[].path (string, required)
#   File path (relative to repo root) to merge.
#   Must be a JSON (.json) or YAML (.yml, .yaml) file.
#   Example: "renovate.json"
#
# sync.files.merge[].strategy (string, default: "deep-merge")
#   Merge strategy to use:
#   - "deep-merge": Recursively merge objects (configured overrides win at leaf level)
#   - "shallow-merge": Only merge top-level keys (nested objects replaced)
#   - "overlay": Alias for "deep-merge"
#
# sync.files.merge[].overrides (object, required)
#   Key-value pairs to override in the org template.
#   Set value to null to explicitly remove a field from the result.
#   For deep-merge: nested paths are merged recursively.
#   For shallow-merge: top-level keys only.
#
# sync.smyklot.skip (boolean, default: false)
#   When true, skips ALL smyklot synchronization (both workflows and version updates).
#   Label and file sync still run unless their respective skip flags are set.
#   Use this for repos that don't use smyklot at all.
#
# sync.smyklot.version.skip (boolean, default: false)
#   When true, skips version-only updates in workflow files.
#   Managed workflows (smyklot-pr-commands, smyklot-poll) are still synced
#   unless their respective workflow flags are disabled.
#   Use this for repos that manage their own smyklot version references.
#
# sync.smyklot.workflows.pr_commands (boolean, default: true)
#   When true, syncs the smyklot-pr-commands.yml workflow to this repository.
#
# sync.smyklot.workflows.poll (boolean, default: true)
#   When true, syncs the smyklot-poll.yml workflow to this repository.
#
# sync.settings.skip (boolean, default: false)
#   When true, skips settings synchronization only.
#   Use this for repos that require custom settings management.
#
# sync.settings.exclude (array of strings, default: [])
#   List of settings paths to exclude from synchronization.
#   Paths use dot notation to reference nested fields.
#   Examples: ["branch_protection", "rulesets", "security.secret_scanning", "features.has_wiki"]
#   Entire sections or individual fields can be excluded.
#
# sync.settings.merge (array of objects, default: [])
#   Configure settings sections to MERGE with org defaults instead of replacing entirely.
#   This allows repos to customize specific fields while inheriting org-wide settings.
#   Follows RFC 7396 (JSON Merge Patch) semantics: objects merge recursively, arrays replaced.
#
# sync.settings.merge[].section (string, required)
#   Section identifier to merge. Valid values:
#   - "repository": Repository settings (name, description, visibility, merge options, etc.)
#   - "features": Feature flags (has_wiki, has_issues, has_projects, has_discussions, etc.)
#   - "security": Security settings (secret_scanning, push_protection, dependabot, etc.)
#   - Branch pattern: For branch protection rules, use the pattern (e.g., "main", "release/*")
#   - Ruleset name: For rulesets, use the ruleset name (e.g., "main-protection")
#
# sync.settings.merge[].strategy (string, default: "deep-merge")
#   Merge strategy to use:
#   - "deep-merge": Recursively merge nested objects (override values win at leaf level)
#   - "shallow-merge": Only merge top-level keys (nested objects completely replaced)
#   - "overlay": Alias for "deep-merge"
#
# sync.settings.merge[].overrides (object, required)
#   Key-value pairs to override in the org settings. Must match the structure
#   defined in the settings schema for the specified section. See:
#   https://raw.githubusercontent.com/smykla-labs/.github/main/schemas/settings.schema.json
#   Set value to null to explicitly remove a field from the result.
#   For deep-merge: nested paths merged recursively.
#   For shallow-merge: top-level keys only.
#
# ---------------------------------------------------------------------------
# EXAMPLES
# ---------------------------------------------------------------------------

# Example 1: Default configuration (all syncs enabled)
# Just create an empty file or omit entirely - defaults apply
sync: {}

# Example 2: Skip all synchronization for this repo
# sync:
#   skip: true

# Example 3: Documentation-only repo (skip CI labels, keep custom docs)
# sync:
#   labels:
#     exclude:
#       - "ci/skip-tests"
#       - "ci/skip-lint"
#       - "ci/skip-build"
#       - "ci/force-full"
#   files:
#     exclude:
#       - "CONTRIBUTING.md"      # Keep custom contributing guide
#       - "CODE_OF_CONDUCT.md"   # Keep custom code of conduct

# Example 4: Strict sync with label cleanup
# sync:
#   labels:
#     allow_removal: true  # Remove labels not in central config
#   files:
#     exclude:
#       - ".github/ISSUE_TEMPLATE/custom-template.yml"

# Example 5: Skip file sync only (labels still sync)
# sync:
#   files:
#     skip: true

# Example 6: Skip all smyklot sync (for repos that don't use smyklot at all)
# sync:
#   smyklot:
#     skip: true

# Example 6a: Skip version updates only (keep workflow sync)
# Use when you manage smyklot versions manually but want workflow templates synced
# sync:
#   smyklot:
#     version:
#       skip: true

# Example 6b: Skip specific workflows (keep version sync)
# Use when you only want certain smyklot workflows
# sync:
#   smyklot:
#     workflows:
#       pr_commands: true
#       poll: false  # Don't sync smyklot-poll workflow

# Example 7: Skip settings sync only (for repos requiring custom settings)
# sync:
#   settings:
#     skip: true

# Example 8: Exclude specific settings (keep custom branch protection and rulesets)
# sync:
#   settings:
#     exclude:
#       - "branch_protection"          # Keep all custom branch protection rules
#       - "rulesets"                   # Keep all custom rulesets (modern protection)
#       - "security.secret_scanning"   # Keep custom secret scanning config
#       - "features.has_wiki"          # Keep wiki enabled

# Example 9: Full customization
# sync:
#   skip: false
#   labels:
#     skip: false
#     exclude:
#       - "release/major"
#       - "release/minor"
#       - "release/patch"
#     allow_removal: false
#   files:
#     skip: false
#     exclude:
#       - "SECURITY.md"
#       - ".github/PULL_REQUEST_TEMPLATE.md"
#     allow_removal: false
#   smyklot:
#     skip: false
#   settings:
#     skip: false
#     exclude:
#       - "rulesets"
#       - "features.has_discussions"

# Example 10: Merge renovate.json with custom rebaseWhen
# sync:
#   files:
#     merge:
#       - path: "renovate.json"
#         strategy: "deep-merge"
#         overrides:
#           rebaseWhen: "conflicted"

# Example 11: Shallow merge with top-level overrides
# sync:
#   files:
#     merge:
#       - path: ".github/workflows/ci.yml"
#         strategy: "shallow-merge"
#         overrides:
#           on:
#             push:
#               branches: ["main", "develop"]

# Example 12: Deep merge with field removal
# NOTE: Arrays are REPLACED entirely per RFC 7396, not merged. If the org template
# has packageRules, setting it here replaces the entire array.
# sync:
#   files:
#     merge:
#       - path: "renovate.json"
#         strategy: "deep-merge"
#         overrides:
#           schedule: null  # Remove schedule from org template
#           rebaseWhen: "conflicted"  # Override single field

# Example 13: Multiple files with different strategies
# sync:
#   files:
#     exclude:
#       - "SECURITY.md"  # Full replacement not wanted
#     merge:
#       - path: "renovate.json"
#         strategy: "deep-merge"
#         overrides:
#           rebaseWhen: "conflicted"
#           timezone: "America/Los_Angeles"
#       - path: ".markdownlint.json"
#         strategy: "shallow-merge"
#         overrides:
#           MD013: false  # Disable line length rule

# ---------------------------------------------------------------------------
# SETTINGS MERGE EXAMPLES
# ---------------------------------------------------------------------------
# Settings merge allows per-repo customization of specific settings while
# inheriting org-wide defaults. Unlike exclude (which skips entirely), merge
# lets you override specific fields.
#
# SCHEMA REFERENCE:
# The overrides field accepts any valid settings structure. For the complete
# list of available fields, see the settings schema:
# https://raw.githubusercontent.com/smykla-labs/.github/main/schemas/settings.schema.json
#
# Key settings sections and their available fields:
#
# "repository" section fields:
#   - allow_merge_commit, allow_rebase_merge, allow_squash_merge (bool)
#   - squash_merge_commit_title: "COMMIT_OR_PR_TITLE" | "PR_TITLE"
#   - squash_merge_commit_message: "PR_BODY" | "COMMIT_MESSAGES" | "BLANK"
#   - allow_update_branch, allow_auto_merge, delete_branch_on_merge (bool)
#   - default_branch, description, homepage, visibility (string)
#   - web_commit_signoff_required, is_template, has_downloads (bool)
#
# "features" section fields:
#   - has_issues, has_wiki, has_projects, has_discussions, has_pages (bool)
#
# "security" section fields:
#   - secret_scanning: "enabled" | "disabled"
#   - secret_scanning_push_protection: "enabled" | "disabled"
#   - dependabot_security_updates: "enabled" | "disabled"
#
# Branch protection (section = pattern like "main") fields:
#   - allow_deletions, allow_force_pushes, enforce_admins (bool)
#   - require_linear_history, required_conversation_resolution (bool)
#   - required_reviews: { required_approving_review_count, dismiss_stale_reviews, ... }
#   - required_status_checks: { strict, contexts, do_not_enforce_on_create }
#   - restrictions: { users, teams, apps }
#
# Rulesets (section = ruleset name) fields:
#   - target (branch/tag), enforcement (active/disabled/evaluate)
#   - bypass_actors: [{ actor_id, actor_type, bypass_mode }]
#   - conditions: { ref_name: { include, exclude } }
#   - rules: { creation, update, deletion, required_signatures, ... }

# Example 14: Override repository settings (enable squash-only merges)
# sync:
#   settings:
#     merge:
#       - section: "repository"
#         strategy: "deep-merge"
#         overrides:
#           allow_merge_commit: false   # Disable merge commits
#           allow_rebase_merge: false   # Disable rebase merges
#           allow_squash_merge: true    # Only squash merges allowed
#           squash_merge_commit_title: "PR_TITLE"
#           squash_merge_commit_message: "PR_BODY"

# Example 15: Enable wiki for documentation repo (org default has it disabled)
# sync:
#   settings:
#     merge:
#       - section: "features"
#         strategy: "deep-merge"
#         overrides:
#           has_wiki: true
#           has_discussions: true

# Example 16: Customize security settings (stricter scanning for sensitive repo)
# sync:
#   settings:
#     merge:
#       - section: "security"
#         strategy: "deep-merge"
#         overrides:
#           secret_scanning: "enabled"
#           secret_scanning_push_protection: "enabled"

# Example 17: Override branch protection for main branch (require more reviewers)
# Branch protection rules are identified by their pattern
# sync:
#   settings:
#     merge:
#       - section: "main"  # Matches branch_protection with pattern "main"
#         strategy: "deep-merge"
#         overrides:
#           required_reviews:
#             count: 3  # Override org default of 2

# Example 18: Customize ruleset by name (stricter rules for release branches)
# Rulesets are identified by their name field
# sync:
#   settings:
#     merge:
#       - section: "release-protection"  # Matches ruleset with name "release-protection"
#         strategy: "deep-merge"
#         overrides:
#           rules:
#             required_linear_history: true
#             required_signatures: true

# Example 19: Multiple settings sections with different strategies
# sync:
#   settings:
#     merge:
#       - section: "repository"
#         strategy: "deep-merge"
#         overrides:
#           description: "Custom repository description"
#           homepage: "https://example.com/docs"
#       - section: "features"
#         strategy: "shallow-merge"  # Replace entire features block
#         overrides:
#           has_issues: true
#           has_wiki: false
#           has_projects: false
#           has_discussions: true

# Example 20: Remove specific field from org settings (use null)
# sync:
#   settings:
#     merge:
#       - section: "repository"
#         strategy: "deep-merge"
#         overrides:
#           homepage: null  # Remove homepage set by org

# Example 21: Combine exclude and merge (skip some, customize others)
# sync:
#   settings:
#     exclude:
#       - "rulesets"  # Don't sync rulesets at all for this repo
#     merge:
#       - section: "repository"
#         strategy: "deep-merge"
#         overrides:
#           allow_auto_merge: true
#       - section: "main"  # Customize main branch protection
#         strategy: "deep-merge"
#         overrides:
#           required_status_checks:
#             strict: true
#             contexts:
#               - "build"
#               - "test"
#               - "security-scan"
